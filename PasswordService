package com.yourpackage;

import jakarta.mail.*;
import jakarta.mail.internet.*;
import org.mindrot.jbcrypt.BCrypt;
import java.util.Properties;
import java.util.UUID;

public class PasswordService {
    @PersistenceContext
    private EntityManager em;

    public void forgotPassword(String username) {
        TypedQuery<User> query = em.createQuery(
            "SELECT u FROM User u WHERE u.username = :username", User.class);
        query.setParameter("username", username);
        User user = query.getResultList().stream()
            .findFirst()
            .orElseThrow(() -> new RuntimeException("User not found"));

        // Generate and save reset token
        String token = UUID.randomUUID().toString();
        PasswordResetToken resetToken = new PasswordResetToken(token, user);
        em.getTransaction().begin();
        new PasswordResetTokenRepository().save(resetToken);
        em.getTransaction().commit();

        sendResetEmail(user.getUsername(), token);
    }
